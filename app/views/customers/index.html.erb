<div class="container container-skynet">
  <div class="container-title margin-bottom-50 clearfix">
    <h2>
      Clientes
      <button type="button" name="button" class="btn btn-230 btn-success float-right" data-toggle='modal' data-target='#new-customer-modal'>
        <%=  fa_icon 'plus' %> Novo cliente
      </button>
    </h2>
  </div>

  <%= render 'notice' %>

  <table class="table table-skynet table-skynet-index table-striped table-hover header-fixed margin-none">
    <thead>
      <tr>
        <th class="w-30">Nome</th>
        <th class="w-25">Email</th>
        <th class="w-15">Celular</th>
        <th class="w-15">Pagamento</th>
        <th class="w-15">Ações</th>
      </tr>
    </thead>
    <tbody id="accordion">
      <% @customers.each_with_index do |customer, index| %>
        <tr id="headingOne">
          <td class="ellipsis">
            <%= link_to customer.name, customer %>
          </td>
          <td class="ellipsis"><%= customer.email %></td>
          <td><%= customer.cellphone %></td>
          <td>
            <% if customer.payments.last.paid == false %>
              <%= link_to '#', class: "btn btn-warning btn-circle", data: { toggle: "modal", target: "#new-payment-modal" }  do %>
                <%=  fa_icon 'pencil', data: { toggle: 'tooltip' }, title: 'Atualizar pagamento' %>
              <% end %>
            <% elsif customer.payments.last.expires_at > Date.current %>
              <%= link_to '#', class: "btn btn-warning btn-danger", data: { toggle: "modal", target: "#new-payment-modal" }  do %>
                <%=  fa_icon 'times', data: { toggle: 'tooltip' }, title: 'Atrasado' %>
              <% end %>
            <% elsif customer.payments.last.expires_at == Date.current %>
              <%= link_to '#', class: "btn btn-warning btn-info", data: { toggle: "modal", target: "#new-payment-modal" }  do %>
                <%=  fa_icon 'check', data: { toggle: 'tooltip' }, title: 'Vence hoje' %>
              <% end %>
            <% else %>
              <%= link_to '#', class: "btn btn-warning btn-success", data: { toggle: "modal", target: "#new-payment-modal" }  do %>
                <%=  fa_icon 'heart', data: { toggle: 'tooltip' }, title: 'Em dia' %>
              <% end %>
            <% end %>
          </td>
          <td>
            <%= link_to customer, class: 'action-icon' do %>
              <%=  fa_icon 'pencil', data: { toggle: 'tooltip' }, title: 'Editar' %>
            <% end %>
            <%= link_to "#", class: 'action-icon', data: { toggle: "modal", target: "#set-gadget-modal" } do %>
              <%=  fa_icon 'wrench', data: { toggle: 'tooltip' }, title: 'Associar equip.' %>
            <% end %>
            <%= link_to customer, class: 'action-icon', data: { method: :delete, confirm: 'Tem certeza?' } do %>
              <%=  fa_icon 'trash-o', data: { toggle: 'tooltip' }, title: 'Remover' %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<%= render 'customers/new_modal' %>
<%= render 'payments/new_modal', customer: @customer %>
<%# FIXME should user current_user.gadgets %>
<%= render 'gadgets/set_modal', gadgets: current_user.all, gadget_allocation: @gadget_allocation %>
