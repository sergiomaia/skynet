<div class="container container-skynet">
  <div class="container-title margin-bottom-50 clearfix">
    <h2>
      Clientes
      <button type="button" name="button" class="btn btn-230 btn-success float-right" data-toggle='modal' data-target='#new-customer-modal'>
        <%=  fa_icon 'plus' %> Novo cliente
      </button>
    </h2>
  </div>

  <%= render 'notice' %>

  <table class="table table-skynet table-skynet-index table-striped table-hover header-fixed margin-none">
    <thead>
      <tr>
        <th class="w-30">Nome</th>
        <th class="w-25">Email</th>
        <th class="w-15">Celular</th>
        <th class="w-15">Pagamento</th>
        <th class="w-15">Ações</th>
      </tr>
    </thead>
    <tbody id="accordion">
      <% @customers.each_with_index do |customer, index| %>
        <tr id="headingOne">
          <td class="ellipsis">
            <!-- What is this? ND56 -->
            <%= link_to customer.name, customer %>  <%# link_to '(+)', '/', data: { toggle: "collapse", target: "#collapse#{index}" }, aria: { expanded: "true", controls: "collapse#{index}" } %>
          </td>
          <td class="ellipsis"><%= customer.email %></td>
          <td><%= customer.cellphone %></td>
          <td>
            <% if customer.payments.last.expires_at.nil? %>
              <%= link_to 'Pendente', class: 'badge badge-pill badge-warning', data: { toggle: "modal", target: "#new-payment-modal" } do %>
                Pendente
              <% end %>
            <% elsif customer.payments.last.expires_at > Date.current %>
              <%= link_to 'Atrasado', class: 'badge badge-pill badge-danger', data: { toggle: "modal", target: "#new-payment-modal" } do %>
                Atrasado
              <% end %>
            <% elsif customer.payments.last.expires_at == Date.current %>
              <%= link_to 'Vence hoje', class: 'badge badge-pill badge-warning', data: { toggle: "modal", target: "#new-payment-modal" } do %>
                Vence hoje
              <% end %>
            <% else %>
              <%= link_to 'Em dia', class: 'badge badge-pill badge-success', data: { toggle: "modal", target: "#new-payment-modal" } do %>
                Em dia
              <% end %>
            <% end %>
          </td>
          <td>
            <%= link_to customer, class: 'action-icon' do %>
              <%=  fa_icon 'pencil', data: { toggle: 'tooltip' }, title: 'Editar' %>
            <% end %>
            <%= link_to "#", class: 'action-icon', data: { toggle: "modal", target: "#set-gadget-modal" } do %>
              <%=  fa_icon 'wrench', data: { toggle: 'tooltip' }, title: 'Associar equip.' %>
            <% end %>
            <%= link_to customer, class: 'action-icon', data: { method: :delete, confirm: 'Tem certeza?' } do %>
              <%=  fa_icon 'trash-o', data: { toggle: 'tooltip' }, title: 'Remover' %>
            <% end %>
          </td>
        </tr>
        <%# customer.packages.each do |package| %>
          <!-- <tr class="collapse">
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr> -->
          <!-- <tr id="<%# "collapse#{index}" %>" class="collapse border-none" aria-labelledby="<%# "heading#{index}" %>" data-parent="#accordion">
            <td>Plano <%# package.plan %></td>
            <td>
              R$ <%# package.value %>
            </td>
            <td>
              <%# package.status %>
            </td>
            <td></td>
            <td></td>
          </tr> -->
        <%# end %>
      <% end %>
    </tbody>
  </table>
</div>

<%= render 'customers/new_modal' %>
<%= render 'payments/new_modal', customer: @customer %>
<%# FIXME should user current_user.gadgets %>
<%= render 'gadgets/set_modal', gadgets: Gadget.all, gadget_allocation: @gadget_allocation %>
